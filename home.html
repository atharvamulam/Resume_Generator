<!DOCTYPE html>
<html ng-app="myApp">
<head>

    <link rel="stylesheet" href="styles.css">

    <title>Resume Generator</title>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.7.9/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body ng-controller="HomeController">
    <div class="content-area">

    <h1>Resume Generator</h1>

    <div>

        <div>
            <h2>Enter details</h2>
            <form ng-submit="addPersonalInfo()">
                <div class="section">
                    <h1>Personal Information</h1>
                    <div class="input-group">
                        <input type="text" ng-model="newPersonalInfo.name" placeholder="Name" required>
                        <input type="text" ng-model="newPersonalInfo.email" placeholder="Email ID" required>
                        <input type="number" ng-model="newPersonalInfo.number" placeholder="Phone Number" required>
                    </div>
                </div>
    
                <div class="section">
                    <h1>Educational Details</h1>
                    <div class="input-group">
                        <input type="text" ng-model="newPersonalInfo.collegeName" placeholder="College Name" required>
                        <input type="text" ng-model="newPersonalInfo.location" placeholder="Location" required>
                        <input type="number" ng-model="newPersonalInfo.cgpa" placeholder="C.G.P.A" required>
                        <input type="number" ng-model="newPersonalInfo.passingYear" placeholder="Passing Year" required>
                    </div>
                </div>

                <div class="section">
                    <h1>Skills</h1>
                    <div class="input-group">
                        <input type="text" ng-model="newPersonalInfo.skills" placeholder="Skills" required>
                    </div>
                </div>
    
                <button type="submit">Add</button>
            </form>
        </div>

    <div class="card" ng-show="personalInfoLoaded">
    <ul class="row">
        <li ng-repeat="product in products" style="width: 25%;">
            <ul>
                <li>Name: {{ product.name }}</li>
                <li>Email ID: {{ product.email }}</li>
                <li>Phone No: {{ product.number }}</li>
                <li>College Name: {{ product.collegeName }}</li>
                <li>Location: {{ product.location }}</li>
                <li>C.G.P.A: {{ product.cgpa }}</li>
                <li>Passing Year: {{ product.passingYear }}</li>
                <li>Skills: {{ product.skills }}</li>
            </ul>
            <button ng-click="deleteProduct(product._id)">Delete</button>
            <button ng-click="editProduct(product)">Edit</button>
            <button ng-click="generatePDF()">Download Resume</button>
        </li>
    </ul>
</div>

    <div ng-show="editingProduct">
        <h2>Edit Product</h2>
        <form ng-submit="updateProduct()">
            <input type="text" ng-model="editingProduct.name" required>
            <input type="text" ng-model="editingProduct.email" required>
            <input type="number" ng-model="editingProduct.number" required>
            <input type="text" ng-model="editingProduct.collegeName" required>
            <input type="text" ng-model="editingProduct.location" required>
            <input type="number" ng-model="editingProduct.cgpa" required>
            <input type="number" ng-model="editingProduct.passingYear" required>
            <input type="text" ng-model="editingProduct.skills" required>
            <button type="submit">Update</button>
        </form>
    </div>

    <script>
        angular.module('myApp', [])
    .controller('HomeController', function($scope, $http) {
        $scope.newPersonalInfo = {};
        $scope.editingProduct = null;
        $scope.products = [];
        $scope.personalInfoLoaded = false;

        // Load products from the server
        $http.get('http://localhost:3000/resume')
            .then(function(response) {
                $scope.products = response.data;
                $scope.personalInfoLoaded = true;
            })
            .catch(function(error) {
                console.error('Error loading products:', error);
            });

        // Function to generate HTML content for the resume
        function generateResumeHTML(resumeData) {
        let htmlContent = '<div class="resume">';
        htmlContent += '<h2>' + resumeData.name + '</h2>';
        htmlContent += '<p>Email: ' + resumeData.email + '</p>';
        htmlContent += '<p>Phone: ' + resumeData.number + '</p>';
        htmlContent += '<p>College: ' + resumeData.collegeName + '</p>';
        htmlContent += '<p>Location: ' + resumeData.location + '</p>';
        htmlContent += '<p>CGPA: ' + resumeData.cgpa + '</p>';
        htmlContent += '<p>Passing Year: ' + resumeData.passingYear + '</p>';
        htmlContent += '<p>Skills: ' + resumeData.skills + '</p>';
        htmlContent += '</div>';
        return htmlContent;
    }

        // Function to generate PDF from HTML content
        $scope.generatePDF = function() {
        const resumeHTML = generateResumeHTML($scope.products[0]); // Assuming there's only one resume data

        const options = {
            filename: 'resume.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        html2pdf().from(resumeHTML).set(options).save();
    }



        $scope.addPersonalInfo = function() {
            $http.post('http://localhost:3000/resume', $scope.newPersonalInfo)
                .then(function(response) {
                    $scope.products.push(response.data);
                    $scope.newPersonalInfo = {};
                })
                .catch(function(error) {
                    console.error('Error adding product:', error);
                });
        };

        $scope.deleteProduct = function(productId) {
            $http.delete('http://localhost:3000/resumes/' + productId)
                .then(function(response) {
                    $scope.products = $scope.products.filter(function(product) {
                        return product._id !== productId;
                    });
                })
                .catch(function(error) {
                    console.error('Error deleting product:', error);
                });
        };

        $scope.editProduct = function(product) {
            $scope.editingProduct = angular.copy(product);
        };

        $scope.updateProduct = function() {
            $http.put('http://localhost:3000/resumes/' + $scope.editingProduct._id, $scope.editingProduct)
                .then(function(response) {
                    // If the update is successful, reset editingProduct
                    $scope.editingProduct = null;
                })
                .catch(function(error) {
                    console.error('Error updating product:', error);
                });
        };

        function updateQuantity(product) {
            debugger;
            $http.put('http://localhost:3000/products/' + product._id, product)
                .then(function(response) {
                    console.log(response.data.message); // Log success message
                })
                .catch(function(error) {
                    console.error('Error updating quantity:', error); // Log error message
                });
        }
    });

    </script>
</body>
</html>
