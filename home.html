<!DOCTYPE html>
<html ng-app="myApp">
  <head>
    <link rel="stylesheet" href="styles.css" />
    <title>Resume Generator</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.7.9/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  </head>
  <body>
    <div style="background-color: #333; overflow: hidden">
      <!-- <img src="#" alt="Logo" style="height: 50px; padding: 10px" /> -->
      <div
        style="
          background-color: black;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 10px 30px;
        "
      >
        <h3>RESUME GENERATOR</h3>
        <nav style="display: flex; gap: 50px">
          <a href="#!/home" style="color: white; text-decoration: none">HOME</a>
          <a href="#!/form" style="color: white; text-decoration: none"
            >GENERATOR</a
          >
          <a href="#!/resumes" style="color: white; text-decoration: none"
            >RESUMES</a>
        </nav>
      </div>
      <div style="padding: 20px" class="content-area" ng-view></div>
    </div>
    <script>
      angular
        .module("myApp", ["ngRoute"])
        .config(function ($routeProvider) {
          $routeProvider
            .when("/home", {
              templateUrl: "index.html",
            })
            .when("/form", {
              templateUrl: "form.html",
              controller: "FormController",
            })
            .when("/resumes", {
              templateUrl: "resumes.html",
              controller: "ResumeController",
            })
            .otherwise({ redirectTo: "/home" });
        })

        .controller("FormController", function ($scope, $http, $location) {
          $scope.newPersonalInfo = {};

          $scope.addPersonalInfo = function () {
            $http
              .post("http://localhost:3000/resume", $scope.newPersonalInfo)
              .then(function (response) {
                $location.path("/resumes");
              })
              .catch(function (error) {
                console.error("Error adding resume:", error);
              });
          };
        })

        .controller("ResumeController", function ($scope, $http) {
          $scope.resumes = [];
          $scope.personalInfoLoaded = false;
          $scope.editingResume = null; // Initialize editingResume variable

          // Load resumes from the server
          $http
            .get("http://localhost:3000/resume")
            .then(function (response) {
              $scope.resumes = response.data;
              $scope.personalInfoLoaded = true;
            })
            .catch(function (error) {
              console.error("Error loading resumes:", error);
            });

          $scope.deleteResume = function (resumeID) {
            $http
              .delete("http://localhost:3000/resumes/" + resumeID)
              .then(function (response) {
                $scope.resumes = $scope.resumes.filter(function (resume) {
                  return resume._id !== resumeID;
                });
              })
              .catch(function (error) {
                console.error("Error deleting resume:", error);
              });
          };

          // Function to edit a resume
          $scope.editResume = function (resume) {
            $scope.editingResume = angular.copy(resume);
          };

          // Function to update a resume
          $scope.updateResume = function () {
            $http
              .put(
                "http://localhost:3000/resumes/" + $scope.editingResume._id,
                $scope.editingResume
              )
              .then(function (response) {
                // If the update is successful, reset editingResume
                $scope.editingResume = null;
              })
              .catch(function (error) {
                console.error("Error updating resume:", error);
              });
          };

          // Function to generate HTML content for the resume
          function generateResumeHTML(resumeData) {
            let htmlContent = '<div class="resume">';
            htmlContent += "<h2>" + resumeData.name + "</h2>";
            htmlContent += "<p style='color: black;'>Email: " + resumeData.email + "</p>";
            htmlContent += "<p style='color: black;'>Phone: " + resumeData.number + "</p>";
            htmlContent += "<p style='color: black;'>College: " + resumeData.collegeName + "</p>";
            htmlContent += "<p style='color: black;'>Location: " + resumeData.location + "</p>";
            htmlContent += "<p style='color: black;'>CGPA: " + resumeData.cgpa + "</p>";
            htmlContent += "<p style='color: black;'>Passing Year: " + resumeData.passingYear + "</p>";
            htmlContent += "<p style='color: black;'>Skills: " + resumeData.skills + "</p>";
            htmlContent += "</div>";
            return htmlContent;
        }


          // Function to generate PDF from HTML content
          $scope.generatePDF = function () {
            const resumeHTML = generateResumeHTML($scope.resumes[0]); // Assuming there's only one resume data

            const options = {
              filename: "resume.pdf",
              image: { type: "jpeg", quality: 0.98 },
              html2canvas: { scale: 2 },
              jsPDF: { unit: "in", format: "letter", orientation: "portrait" },
            };

            html2pdf().from(resumeHTML).set(options).save();
          };
        });
    </script>
  </body>
</html>
