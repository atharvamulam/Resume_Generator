<!DOCTYPE html>
<html ng-app="myApp">
<head>

    <link rel="stylesheet" href="styles.css">

    <title>Resume Generator</title>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.7.9/angular-route.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body ng-controller="HomeController">
    <div class="content-area">

    <h1>Resume Generator</h1>

    <div>

        <div>
            <h2>Enter details</h2>
            <form ng-submit="addPersonalInfo()">
                <div class="section">
                    <h1>Personal Information</h1>
                    <div class="input-group">
                        <input type="text" ng-model="newPersonalInfo.name" placeholder="Name" required>
                        <input type="text" ng-model="newPersonalInfo.email" placeholder="Email ID" required>
                        <input type="number" ng-model="newPersonalInfo.number" placeholder="Phone Number" required>
                    </div>
                </div>
    
                <div class="section">
                    <h1>Educational Details</h1>
                    <div class="input-group">
                        <input type="text" ng-model="newPersonalInfo.collegeName" placeholder="College Name" required>
                        <input type="text" ng-model="newPersonalInfo.location" placeholder="Location" required>
                        <input type="number" ng-model="newPersonalInfo.cgpa" placeholder="C.G.P.A" required>
                        <input type="number" ng-model="newPersonalInfo.passingYear" placeholder="Passing Year" required>
                    </div>
                </div>

                <div class="section">
                    <h1>Skills</h1>
                    <div class="input-group">
                        <input type="text" ng-model="newPersonalInfo.skills" placeholder="Skills" required>
                    </div>
                </div>
                <button type="submit">Add</button>
            </form>
        </div>

    <div class="card" ng-show="personalInfoLoaded">
    <h1>RESUMES GENERATED</h1>
    <ul class="row">
        <li ng-repeat="resume in resumes" style="width: 90%;">
            <ul>
                <li>Name: {{ resume.name }}</li>
                <li>Email ID: {{ resume.email }}</li>
                <li>Phone No: {{ resume.number }}</li>
                <li>College Name: {{ resume.collegeName }}</li>
                <li>Location: {{ resume.location }}</li>
                <li>C.G.P.A: {{ resume.cgpa }}</li>
                <li>Passing Year: {{ resume.passingYear }}</li>
                <li>Skills: {{ resume.skills }}</li>
            </ul>
            <button ng-click="deleteResume(resume._id)">Delete</button>
            <button ng-click="editResume(resume)">Edit</button>
            <button ng-click="generatePDF()">Download Resume</button>
        </li>
    </ul>
</div>

    <div ng-show="editingResume">
        <h2>Edit Resume</h2>
        <form ng-submit="updateResume()">
            <input type="text" ng-model="editingResume.name" required>
            <input type="text" ng-model="editingResume.email" required>
            <input type="number" ng-model="editingResume.number" required>
            <input type="text" ng-model="editingResume.collegeName" required>
            <input type="text" ng-model="editingResume.location" required>
            <input type="number" ng-model="editingResume.cgpa" required>
            <input type="number" ng-model="editingResume.passingYear" required>
            <input type="text" ng-model="editingResume.skills" required>
            <button type="submit">Update</button>
        </form>
    </div>

    <script>
        angular.module('myApp', [])
    .controller('HomeController', function($scope, $http) {
        $scope.newPersonalInfo = {};
        $scope.editingResume = null;
        $scope.resumes = [];
        $scope.personalInfoLoaded = false;

        // Load resumes from the server
        $http.get('http://localhost:3000/resume')
            .then(function(response) {
                $scope.resumes = response.data;
                $scope.personalInfoLoaded = true;
            })
            .catch(function(error) {
                console.error('Error loading resumes:', error);
            });

        // Function to generate HTML content for the resume
        function generateResumeHTML(resumeData) {
        let htmlContent = '<div class="resume">';
        htmlContent += '<h2>' + resumeData.name + '</h2>';
        htmlContent += '<p>Email: ' + resumeData.email + '</p>';
        htmlContent += '<p>Phone: ' + resumeData.number + '</p>';
        htmlContent += '<p>College: ' + resumeData.collegeName + '</p>';
        htmlContent += '<p>Location: ' + resumeData.location + '</p>';
        htmlContent += '<p>CGPA: ' + resumeData.cgpa + '</p>';
        htmlContent += '<p>Passing Year: ' + resumeData.passingYear + '</p>';
        htmlContent += '<p>Skills: ' + resumeData.skills + '</p>';
        htmlContent += '</div>';
        return htmlContent;
    }

        // Function to generate PDF from HTML content
        $scope.generatePDF = function() {
        const resumeHTML = generateResumeHTML($scope.resumes[0]); // Assuming there's only one resume data

        const options = {
            filename: 'resume.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };

        html2pdf().from(resumeHTML).set(options).save();
    }



        $scope.addPersonalInfo = function() {
            $http.post('http://localhost:3000/resume', $scope.newPersonalInfo)
                .then(function(response) {
                    $scope.resumes.push(response.data);
                    $scope.newPersonalInfo = {};
                })
                .catch(function(error) {
                    console.error('Error adding resume:', error);
                });
        };

        $scope.deleteResume = function(resumeID) {
            $http.delete('http://localhost:3000/resumes/' + resumeID)
                .then(function(response) {
                    $scope.resumes = $scope.resumes.filter(function(resume) {
                        return resume._id !== resumeID;
                    });
                })
                .catch(function(error) {
                    console.error('Error deleting resume:', error);
                });
        };

        $scope.editResume = function(resume) {
            $scope.editingResume = angular.copy(resume);
        };

        $scope.updateResume = function() {
            $http.put('http://localhost:3000/resumes/' + $scope.editingResume._id, $scope.editingResume)
                .then(function(response) {
                    // If the update is successful, reset editingResume
                    $scope.editingResume = null;
                })
                .catch(function(error) {
                    console.error('Error updating resume:', error);
                });
        };

        function updateQuantity(resume) {
            debugger;
            $http.put('http://localhost:3000/resumes/' + resume._id, resume)
                .then(function(response) {
                    console.log(response.data.message); // Log success message
                })
                .catch(function(error) {
                    console.error('Error updating quantity:', error); // Log error message
                });
        }
    });

    </script>
</body>
</html>
