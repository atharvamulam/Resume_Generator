<!DOCTYPE html>
<html ng-app="myApp">
<head>

    <link rel="stylesheet" href="styles.css">

    <title>Bharat Bankz</title>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-route/1.7.9/angular-route.min.js"></script>
</head>
<body ng-controller="HomeController">
    <div class="content-area">

    <h1>Hello Citizens</h1>

    <div>

    <div>
        <h2>Add Customer</h2>
        <form ng-submit="addProduct()">
            <input type="text" ng-model="newProduct.name" placeholder="Customer Name" required>
            <input type="number" ng-model="newProduct.price" placeholder="Phone number" required>
            <input type="number" ng-model="newProduct.quantity" placeholder="Deposite" required>
            <button type="submit">Add</button>
        </form>
    </div>

    <div class="card" ng-show="productsLoaded">
    <h2>Account Holders</h2>
    <ul class="row">
        <li ng-repeat="product in products" style="width: 25%;">
            <ul>
                <li>Name: {{ product.name }}</li>
                <li>Phone no: {{ product.price }}</li>
                <li>Amount: {{ product.quantity }}</li>
            </ul>
            <button ng-click="incrementQuantity(product)">Increment</button>
            <button ng-click="decrementQuantity(product)">Decrement</button>
            <button ng-click="deleteProduct(product._id)">Delete</button>
            <button ng-click="editProduct(product)">Edit</button>
        </li>
    </ul>
</div>

    <div ng-show="editingProduct">
        <h2>Edit Product</h2>
        <form ng-submit="updateProduct()">
            <input type="text" ng-model="editingProduct.name" required>
            <input type="number" ng-model="editingProduct.price" required>
            <input type="number" ng-model="editingProduct.quantity" required>
            <button type="submit">Update</button>
        </form>
    </div>

    <script>
        angular.module('myApp', [])
    .controller('HomeController', function($scope, $http) {
        $scope.newProduct = {};
        $scope.editingProduct = null;
        $scope.products = [];
        $scope.productsLoaded = false;

        // Load products from the server
        $http.get('http://localhost:3000/products')
            .then(function(response) {
                $scope.products = response.data;
                $scope.productsLoaded = true;
            })
            .catch(function(error) {
                console.error('Error loading products:', error);
            });

        $scope.addProduct = function() {
            $http.post('http://localhost:3000/products', $scope.newProduct)
                .then(function(response) {
                    $scope.products.push(response.data);
                    $scope.newProduct = {};
                })
                .catch(function(error) {
                    console.error('Error adding product:', error);
                });
        };

        $scope.deleteProduct = function(productId) {
            $http.delete('http://localhost:3000/products/' + productId)
                .then(function(response) {
                    $scope.products = $scope.products.filter(function(product) {
                        return product._id !== productId;
                    });
                })
                .catch(function(error) {
                    console.error('Error deleting product:', error);
                });
        };

        $scope.editProduct = function(product) {
            $scope.editingProduct = angular.copy(product);
        };

        $scope.updateProduct = function() {
            $http.put('http://localhost:3000/products/' + $scope.editingProduct._id, $scope.editingProduct)
                .then(function(response) {
                    // If the update is successful, reset editingProduct
                    $scope.editingProduct = null;
                })
                .catch(function(error) {
                    console.error('Error updating product:', error);
                });
        };

        $scope.incrementQuantity = function(product) {
            product.quantity+=100; // Increment the quantity locally
            updateQuantity(product); // Call the function to update the quantity in the database
        };

        $scope.decrementQuantity = function(product) {
            if (product.quantity > 0) { // Ensure quantity doesn't go negative
                product.quantity-=100; // Decrement the quantity locally
                updateQuantity(product); // Call the function to update the quantity in the database
            }
        };

        function updateQuantity(product) {
            debugger;
            $http.put('http://localhost:3000/products/' + product._id, product)
                .then(function(response) {
                    console.log(response.data.message); // Log success message
                })
                .catch(function(error) {
                    console.error('Error updating quantity:', error); // Log error message
                });
        }
    });

    </script>
</body>
</html>
